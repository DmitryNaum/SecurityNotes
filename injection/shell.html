<!DOCTYPE html>
<html lang="en-us">

    <head>
        <meta charset="UTF-8">
        <title>SQL Injection - SQL инъекции | Security Notes by DmitryNaum</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="../stylesheets/normalize.css" media="screen">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../stylesheets/monokai_sublime.css" media="screen">
    </head>

    <body>
        <section class="page-header">
            <h1 class="project-name">Security Notes</h1>
            <h2 class="project-tagline">Заметки по безопасности web приложений</h2>
            <a href="https://github.com/DmitryNaum/securityNotes" class="btn">GitHub репозиторий</a>
            <a href="https://github.com/DmitryNaum/securityNotes/zipball/master" class="btn">.zip</a>
            <a href="https://github.com/DmitryNaum/securityNotes/tarball/master" class="btn">.tar.gz</a>
        </section>

        <section class="main-content">
            <ul class="breadcrumbs">
                <li><a href="../index.html">Главная</a></li>
                <li><a href="index.html">Injection</a></li>
                <li>Shell Injection</li>
            </ul>
            <h3 id="что-такое-shell-injection"><a id="about"></a> <a href="#about">Что такое Shell Injection.</a></h3>

            <p>Shell инъекция - внедрение shell кода в shell запрос. Позволяет выполнять произвольные команды не веб сервере.</p>



            <h3 id="пример-уязвимости-shell-injection"><a id="example"></a> <a href="#example">Пример уязвимости Shell Injection.</a></h3>

            <p>Предположим есть веб сайт на котором можно пропинговать произвольный ресурс. Для выполнения пинга отправляется GET запрос на url <code>site.hach/ping/?host=ya.ru</code>. Предположим что сервер выполняет пинг при помощи кода ниже</p>



            <pre class="prettyprint"><code class="language-php hljs "><span class="hljs-variable">$host</span>    = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'host'</span>];
<span class="hljs-variable">$command</span> = <span class="hljs-string">"ping '$host'"</span>;
<span class="hljs-variable">$ping</span>    = exec(<span class="hljs-variable">$command</span>);

<span class="hljs-keyword">echo</span> join(<span class="hljs-string">'\n'</span>, <span class="hljs-variable">$ping</span>);</code></pre>

            <p>Проблема заключается в том, что нет никакой проверки получаемых данных, и злоумышленник может выполнить на сервере произвольную команду просто изменив запрос на <code>site.hach/ping/?host=ya.ru'; rm -rf /*'</code>. Таким образом на сервере будет выполнена следующая команда</p>



            <pre class="prettyprint"><code class="language-shell hljs bash">ping <span class="hljs-string">'ya.ru'</span>; rm -rf /*<span class="hljs-string">''</span></code></pre>

            <p>И с сервера будет удалено абсолютна вся информация</p>



            <h3 id="защита-от-shell-injection"><a id="protection"></a> <a href="#protection">Защита от Shell Injection.</a></h3>

            <p>В PHP Есть замечательная функция <a href="http://php.net/manual/ru/function.escapeshellcmd.php">escapeshellcmd</a> которая экранирует все метасимволы символы командной строки.</p>

            <blockquote>
                <p>Команда escapeshellcmd() экранирует любые символы в строке, которые могут быть использованы для обмана шелл-команд при выполнении произвольных команд. Эта функция должна быть использована для того, чтобы убедиться, что любые данные, вводимые пользователем, экранированы перед передачей их функции exec() или system(), или оператору “обратный апостроф”.</p>
            </blockquote>

            <p>Ниже представлен код который не допустит выполнения shell инъекции</p>



            <pre class="prettyprint"><code class="language-php hljs "><span class="hljs-variable">$host</span>    = escapeshellcmd(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'host'</span>]);
<span class="hljs-variable">$command</span> = <span class="hljs-string">"ping '$host'"</span>;
<span class="hljs-variable">$ping</span>    = exec(<span class="hljs-variable">$command</span>);

<span class="hljs-keyword">echo</span> join(<span class="hljs-string">'\n'</span>, <span class="hljs-variable">$ping</span>);</code></pre>

            <p>Таким образом при попытке выполнить инъекцию мы получится следующий Shell запрос</p>



            <pre class="prettyprint"><code class="language-shell hljs bash">ping <span class="hljs-string">'ya.ru'</span>\; rm -rf /* <span class="hljs-string">''</span></code></pre>

            <p>Как видно, функция escapeshellcmd экранировала символ <code>;</code> что защитило нас от выполнения второй команды </p>

            <footer class="site-footer">
                <span class="site-footer-owner"><a href="https://github.com/DmitryNaum/securityNotes">Security Notes</a> is maintained by <a href="https://github.com/DmitryNaum">DmitryNaum</a>.</span>

                <span class="site-footer-credits">Using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
            </footer>

        </section>

        <script src="../js/main.js"></script>
    </body>

</html>